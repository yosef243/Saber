<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4BLGD8FVRY"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-4BLGD8FVRY');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1E6F5C">
    <meta name="description" content="ØµØ¯Ù‚Ø© Ø¬Ø§Ø±ÙŠØ©ØŒ Ù‚Ø±Ø¢Ù† ÙƒØ±ÙŠÙ…ØŒ ÙˆØ£Ø¯Ø¹ÙŠØ© Ù„Ù„Ù…Ø±Ø­ÙˆÙ… ØµØ¨Ø±ÙŠ ÙƒØ§Ù…Ù„ Ø³Ù„ÙŠÙ…">
    
    <title>Ø§Ù„Ù…Ø±Ø­ÙˆÙ… ØµØ¨Ø±ÙŠ ÙƒØ§Ù…Ù„ Ø³Ù„ÙŠÙ… | ØµØ¯Ù‚Ø© Ø¬Ø§Ø±ÙŠØ©</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192x192.png">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        :root {
            --primary: #1E6F5C;
            --secondary: #F4F9F4;
            --accent: #E9C46A;
            --text-main: #1F2937;
            --text-sub: #4B5563;
            --card-bg: #FFFFFF;
            --border: #E5E7EB;
            --shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            --font-main: 'Tajawal', sans-serif;
            --font-quran: 'Amiri', serif;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        [data-theme="dark"] {
            --primary: #2A9D8F;
            --secondary: #111827;
            --accent: #E9C46A;
            --text-main: #F9FAFB;
            --text-sub: #9CA3AF;
            --card-bg: #1F2937;
            --border: #374151;
            --shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: var(--font-main);
            color: var(--text-main);
            min-height: 100vh;
            display: flex; flex-direction: column; align-items: center;
            transition: background 0.3s ease, color 0.3s ease;
            overflow-x: hidden;
            background: linear-gradient(135deg, #F4F9F4 0%, #E9F5E9 100%);
        }

        [data-theme="dark"] body { background: linear-gradient(135deg, #111827 0%, #1F2937 100%); }

        /* Animations */
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(30, 111, 92, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(30, 111, 92, 0); }
            100% { box-shadow: 0 0 0 0 rgba(30, 111, 92, 0); }
        }
        
        .fade-in-up { animation: fadeInUp 0.5s ease forwards; opacity: 0; transform: translateY(20px); }
        @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }

        /* Header */
        header { width: 100%; max-width: 600px; padding: 20px; display: flex; flex-direction: column; align-items: center; text-align: center; }
        .top-bar { width: 100%; display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .icon-btn { background: none; border: none; color: var(--text-main); font-size: 1.4rem; cursor: pointer; padding: 8px; border-radius: 50%; transition: var(--transition); }
        .icon-btn:hover { background-color: rgba(0,0,0,0.05); }

        .deceased-name { font-size: 1.8rem; font-weight: 800; color: var(--primary); margin: 5px 0; line-height: 1.3; }
        .deceased-prayer { font-size: 0.95rem; color: var(--text-sub); background: rgba(0,0,0,0.05); padding: 10px 15px; border-radius: 12px; margin-top: 8px; line-height: 1.6; max-width: 90%; border: 1px solid var(--border); }

        /* Tabs */
        .tabs-container { width: 95%; max-width: 600px; background: var(--card-bg); padding: 6px; border-radius: 16px; box-shadow: var(--shadow); display: flex; gap: 5px; margin: 10px 0 20px; position: sticky; top: 10px; z-index: 50; overflow-x: auto; scrollbar-width: none; }
        .tabs-container::-webkit-scrollbar { display: none; }
        .tab-btn { flex: 0 0 auto; min-width: 80px; background: none; border: none; padding: 10px 15px; font-family: var(--font-main); font-weight: 500; color: var(--text-sub); border-radius: 12px; cursor: pointer; transition: var(--transition); font-size: 0.9rem; white-space: nowrap; }
        .tab-btn.active { background-color: var(--primary); color: #FFFFFF; font-weight: 700; }

        /* Main */
        main { width: 100%; max-width: 600px; padding: 0 20px 40px; flex: 1; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeInUp 0.4s ease; }
        .card { background-color: var(--card-bg); border-radius: 24px; padding: 24px; box-shadow: var(--shadow); margin-bottom: 20px; border: 1px solid var(--border); position: relative; transition: transform 0.3s ease; }
        
        /* Masbaha */
        .dhikr-display { font-family: var(--font-quran); font-size: 2rem; text-align: center; color: var(--primary); min-height: 80px; display: flex; align-items: center; justify-content: center; margin-bottom: 25px; font-weight: 700; line-height: 1.4; padding: 0 10px; }
        .counter-container { width: 220px; height: 220px; margin: 0 auto 30px; position: relative; cursor: pointer; }
        .counter-circle { width: 100%; height: 100%; border-radius: 50%; background: linear-gradient(145deg, var(--primary), #2A9D8F); display: flex; flex-direction: column; justify-content: center; align-items: center; color: white; box-shadow: 0 10px 30px -5px rgba(30, 111, 92, 0.4); transition: transform 0.05s; position: relative; z-index: 2; animation: pulse 3s infinite; }
        .counter-circle:active { transform: scale(0.95); animation: none; }
        .count-num { font-size: 5rem; font-weight: 800; line-height: 1; }
        
        /* Dua */
        .dua-container { min-height: 180px; display: flex; flex-direction: column; justify-content: center; }
        .dua-controls { display: flex; justify-content: space-between; align-items: center; margin-top: 20px; border-top: 1px solid var(--border); padding-top: 15px; }
        .nav-btn { background: rgba(0,0,0,0.05); border: none; color: var(--primary); width: 40px; height: 40px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; }
        .copy-btn { display: flex; align-items: center; gap: 5px; background: none; border: 1px solid var(--primary); color: var(--primary); padding: 8px 16px; border-radius: 20px; font-size: 0.9rem; font-weight: 600; cursor: pointer; }

        /* Azkar */
        .azkar-toggle { display: flex; background: rgba(0,0,0,0.05); border-radius: 12px; padding: 4px; margin-bottom: 20px; }
        .azkar-opt { flex: 1; border: none; background: none; padding: 10px; border-radius: 8px; cursor: pointer; color: var(--text-sub); font-family: var(--font-main); font-weight: 600; }
        .azkar-opt.active { background: var(--card-bg); color: var(--primary); box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .zekr-item { border-bottom: 1px solid var(--border); padding: 15px 0; }
        
        /* Quran Audio Styles (NEW) */
        .quran-btn-lg { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 15px; font-size: 1.1rem; font-weight: bold; margin-bottom: 15px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; box-shadow: 0 4px 10px rgba(30, 111, 92, 0.2); }
        .audio-controls { display: flex; gap: 10px; margin-top: 8px; }
        .audio-btn { flex: 1; padding: 8px 12px; background: linear-gradient(145deg, var(--primary), #2A9D8F); color: white; border: none; border-radius: 10px; font-family: var(--font-main); font-weight: 600; font-size: 0.85rem; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 5px; transition: var(--transition); }
        .audio-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(30, 111, 92, 0.3); }
        .audio-btn.secondary { background: rgba(0,0,0,0.08); color: var(--text-main); }
        .playing-indicator { display: none; width: 8px; height: 8px; background: #fff; border-radius: 50%; margin-left: 5px; animation: pulse 1s infinite; }

        /* Footer */
        footer { text-align: center; padding: 20px; color: var(--text-sub); font-size: 0.9rem; margin-top: auto; }
        .visitor-counter { font-family: monospace; background: rgba(0,0,0,0.05); padding: 8px 15px; border-radius: 8px; margin-top: 10px; display: inline-block; direction: ltr; font-weight: bold; color: var(--primary); border: 1px solid var(--border); }
    </style>
</head>
<body>

    <header class="fade-in-up" style="animation-delay: 0.1s;">
        <div class="top-bar">
            <button class="icon-btn" onclick="shareCurrentPage()" title="Ù…Ø´Ø§Ø±ÙƒØ©"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 12v8a2 2 0 002 2h12a2 2 0 002-2v-8"/><polyline points="16 6 12 2 8 6"/><line x1="12" y1="2" x2="12" y2="15"/></svg></button>
            <button class="icon-btn" onclick="toggleTheme()" id="themeBtn" title="Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ">ğŸŒ™</button>
        </div>

        <div class="deceased-info">
            <div style="font-size: 0.9rem; color: var(--text-sub);">ØµØ¯Ù‚Ø© Ø¬Ø§Ø±ÙŠØ© Ø¹Ù† Ø±ÙˆØ­</div>
            <div class="deceased-name">Ø§Ù„Ù…Ø±Ø­ÙˆÙ… ØµØ¨Ø±ÙŠ ÙƒØ§Ù…Ù„ Ø³Ù„ÙŠÙ…</div>
            <div class="deceased-prayer">
                Ø§Ù„Ù„Ù‡Ù… Ø§Ø±Ø­Ù…Ù‡ ÙˆØ§ØºÙØ± Ù„Ù‡ ÙˆØ§Ø¬Ø¹Ù„ Ù‚Ø¨Ø±Ù‡ Ø±ÙˆØ¶Ø© Ù…Ù† Ø±ÙŠØ§Ø¶ Ø§Ù„Ø¬Ù†Ø© ÙˆØ§Ø³ÙƒÙ†Ù‡ Ø§Ù„ÙØ±Ø¯ÙˆØ³ Ø§Ù„Ø£Ø¹Ù„Ù‰
            </div>
        </div>
    </header>

    <nav class="tabs-container fade-in-up" style="animation-delay: 0.2s;">
        <button class="tab-btn active" onclick="switchTab('masbaha', this)">Ø§Ù„Ù…Ø³Ø¨Ø­Ø©</button>
        <button class="tab-btn" onclick="switchTab('deceased_dua', this)">Ù„Ù„Ù…ØªÙˆÙÙ‰</button>
        <button class="tab-btn" onclick="switchTab('general_dua', this)">Ø£Ø¯Ø¹ÙŠØ© Ø¹Ø§Ù…Ø©</button>
        <button class="tab-btn" onclick="switchTab('azkar', this)">Ø§Ù„Ø£Ø°ÙƒØ§Ø±</button>
        <button class="tab-btn" onclick="switchTab('quran', this)">Ø§Ù„Ù‚Ø±Ø¢Ù†</button>
    </nav>

    <main class="fade-in-up" style="animation-delay: 0.3s;">
        <div id="masbaha" class="tab-content active">
            <div class="card" style="text-align: center;">
                <div class="dhikr-display" id="dhikrText">Ø³ÙØ¨Ù’Ø­ÙØ§Ù†Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù</div>
                <div class="counter-container" onclick="incrementCounter()">
                    <div class="counter-circle">
                        <div class="count-num" id="totalCounter">0</div>
                        <div style="font-size: 0.9rem; opacity: 0.9;" id="batchCounter">Ø§Ù„Ø¯ÙˆØ±Ø©: 1</div>
                    </div>
                </div>
                <button class="icon-btn" onclick="confirmReset()" style="font-size: 1rem; width: auto; border-radius: 8px;">ØªØµÙÙŠØ± â†º</button>
            </div>
        </div>

        <div id="deceased_dua" class="tab-content">
            <div class="card">
                <div style="color: var(--accent); font-size: 1.4rem; text-align: center; margin-bottom: 15px; font-weight: 700;">Ø£Ø¯Ø¹ÙŠØ© Ù„Ù„Ù…ØªÙˆÙÙ‰</div>
                <div class="dua-container">
                    <div style="font-family: 'Amiri'; font-size: 1.3rem; line-height: 2.2; text-align: justify; color: var(--text-main);" id="deceasedDuaText"></div>
                </div>
                <div class="dua-controls">
                    <button class="nav-btn" onclick="changeDua('deceased', -1)">&#10095;</button> 
                    <button class="copy-btn" onclick="copyDua('deceased')"><span>Ù†Ø³Ø® Ø§Ù„Ø¯Ø¹Ø§Ø¡</span> ğŸ“‹</button>
                    <button class="nav-btn" onclick="changeDua('deceased', 1)">&#10094;</button> 
                </div>
                <div style="text-align: center; font-size: 0.8rem; color: var(--text-sub); margin-top: 10px;">
                    <span id="deceasedCounter">1</span> / <span id="deceasedTotal"></span>
                </div>
            </div>
        </div>

        <div id="general_dua" class="tab-content">
            <div class="card">
                <div style="color: var(--accent); font-size: 1.4rem; text-align: center; margin-bottom: 15px; font-weight: 700;">Ø£Ø¯Ø¹ÙŠØ© Ø¹Ø§Ù…Ø©</div>
                <div class="dua-container">
                    <div style="font-family: 'Amiri'; font-size: 1.3rem; line-height: 2.2; text-align: justify; color: var(--text-main);" id="generalDuaText"></div>
                </div>
                <div class="dua-controls">
                    <button class="nav-btn" onclick="changeDua('general', -1)">&#10095;</button> 
                    <button class="copy-btn" onclick="copyDua('general')"><span>Ù†Ø³Ø® Ø§Ù„Ø¯Ø¹Ø§Ø¡</span> ğŸ“‹</button>
                    <button class="nav-btn" onclick="changeDua('general', 1)">&#10094;</button> 
                </div>
                <div style="text-align: center; font-size: 0.8rem; color: var(--text-sub); margin-top: 10px;">
                    <span id="generalCounter">1</span> / <span id="generalTotal"></span>
                </div>
            </div>
        </div>

        <div id="azkar" class="tab-content">
            <div class="card">
                <div class="azkar-toggle">
                    <button class="azkar-opt active" onclick="toggleAzkar('morning', this)">Ø£Ø°ÙƒØ§Ø± Ø§Ù„ØµØ¨Ø§Ø­ â˜€ï¸</button>
                    <button class="azkar-opt" onclick="toggleAzkar('evening', this)">Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ù…Ø³Ø§Ø¡ ğŸŒ™</button>
                </div>
                <div id="azkarList"></div>
            </div>
        </div>

        <div id="quran" class="tab-content">
            <div class="card">
                <div style="color: var(--accent); font-size: 1.4rem; text-align: center; margin-bottom: 15px; font-weight: 700;">Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…</div>
                
                <button class="quran-btn-lg" onclick="window.open('https://quran.com/ar', '_blank')">
                    <span>ğŸ“–</span> Ø§Ù„Ù…ØµØ­Ù Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙƒØ§Ù…Ù„Ø§Ù‹
                </button>
                
                <div style="margin-top: 20px;">
                    <div style="font-size: 1rem; color: var(--text-sub); margin-bottom: 15px; font-weight: bold;">Ø³ÙˆØ± Ù…Ø®ØªØ§Ø±Ø© Ù…Ø¹ ØªÙ„Ø§ÙˆØ©:</div>
                    
                    <div style="background: rgba(0,0,0,0.03); border-radius: 12px; margin-bottom: 15px; padding: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <span style="font-weight: 600; color: var(--text-main);">Ø³ÙˆØ±Ø© ÙŠØ³</span>
                            <span>ğŸ“–</span>
                        </div>
                        <div class="audio-controls">
                            <button class="audio-btn" onclick="playAudio('https://cdn.islamic.network/quran/audio/128/ar.alafasy/36.mp3', this)">
                                <span class="playing-indicator"></span><span>ğŸ§ Ø§Ù„Ø¹ÙØ§Ø³ÙŠ</span>
                            </button>
                            <button class="audio-btn secondary" onclick="playAudio('https://cdn.islamic.network/quran/audio/128/ar.abdulsamad/36.mp3', this)">
                                <span class="playing-indicator"></span><span>ğŸ§ Ø¹Ø¨Ø¯ Ø§Ù„Ø¨Ø§Ø³Ø·</span>
                            </button>
                            <a href="https://quran.com/ar/36" target="_blank" style="text-decoration: none; flex: 0.5;">
                                <button class="audio-btn secondary" style="background: rgba(0,0,0,0.05); width: 100%;">Ù‚Ø±Ø§Ø¡Ø©</button>
                            </a>
                        </div>
                    </div>
                    
                    <div style="background: rgba(0,0,0,0.03); border-radius: 12px; margin-bottom: 15px; padding: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <span style="font-weight: 600; color: var(--text-main);">Ø³ÙˆØ±Ø© Ø§Ù„Ù…Ù„Ùƒ</span>
                            <span>ğŸ“–</span>
                        </div>
                        <div class="audio-controls">
                            <button class="audio-btn" onclick="playAudio('https://cdn.islamic.network/quran/audio/128/ar.alafasy/67.mp3', this)">
                                <span class="playing-indicator"></span><span>ğŸ§ Ø§Ù„Ø¹ÙØ§Ø³ÙŠ</span>
                            </button>
                            <button class="audio-btn secondary" onclick="playAudio('https://cdn.islamic.network/quran/audio/128/ar.abdulsamad/67.mp3', this)">
                                <span class="playing-indicator"></span><span>ğŸ§ Ø¹Ø¨Ø¯ Ø§Ù„Ø¨Ø§Ø³Ø·</span>
                            </button>
                            <a href="https://quran.com/ar/67" target="_blank" style="text-decoration: none; flex: 0.5;">
                                <button class="audio-btn secondary" style="background: rgba(0,0,0,0.05); width: 100%;">Ù‚Ø±Ø§Ø¡Ø©</button>
                            </a>
                        </div>
                    </div>

                    <div style="background: rgba(0,0,0,0.03); border-radius: 12px; margin-bottom: 15px; padding: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <span style="font-weight: 600; color: var(--text-main);">Ø³ÙˆØ±Ø© Ø§Ù„ÙƒÙ‡Ù</span>
                            <span>ğŸ“–</span>
                        </div>
                        <div class="audio-controls">
                            <button class="audio-btn" onclick="playAudio('https://cdn.islamic.network/quran/audio/128/ar.alafasy/18.mp3', this)">
                                <span class="playing-indicator"></span><span>ğŸ§ Ø§Ù„Ø¹ÙØ§Ø³ÙŠ</span>
                            </button>
                            <button class="audio-btn secondary" onclick="playAudio('https://cdn.islamic.network/quran/audio/128/ar.abdulsamad/18.mp3', this)">
                                <span class="playing-indicator"></span><span>ğŸ§ Ø¹Ø¨Ø¯ Ø§Ù„Ø¨Ø§Ø³Ø·</span>
                            </button>
                            <a href="https://quran.com/ar/18" target="_blank" style="text-decoration: none; flex: 0.5;">
                                <button class="audio-btn secondary" style="background: rgba(0,0,0,0.05); width: 100%;">Ù‚Ø±Ø§Ø¡Ø©</button>
                            </a>
                        </div>
                    </div>

                    <div style="background: rgba(0,0,0,0.03); border-radius: 12px; margin-bottom: 10px; padding: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <span style="font-weight: 600; color: var(--text-main);">Ø³ÙˆØ±Ø© Ø§Ù„ÙˆØ§Ù‚Ø¹Ø©</span>
                            <span>ğŸ“–</span>
                        </div>
                        <div class="audio-controls">
                            <button class="audio-btn" onclick="playAudio('https://cdn.islamic.network/quran/audio/128/ar.alafasy/56.mp3', this)">
                                <span class="playing-indicator"></span><span>ğŸ§ Ø§Ù„Ø¹ÙØ§Ø³ÙŠ</span>
                            </button>
                            <button class="audio-btn secondary" onclick="playAudio('https://cdn.islamic.network/quran/audio/128/ar.abdulsamad/56.mp3', this)">
                                <span class="playing-indicator"></span><span>ğŸ§ Ø¹Ø¨Ø¯ Ø§Ù„Ø¨Ø§Ø³Ø·</span>
                            </button>
                            <a href="https://quran.com/ar/56" target="_blank" style="text-decoration: none; flex: 0.5;">
                                <button class="audio-btn secondary" style="background: rgba(0,0,0,0.05); width: 100%;">Ù‚Ø±Ø§Ø¡Ø©</button>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div style="margin-bottom: 10px;">Ø§Ù„Ù„Ù‡Ù… ØªÙ‚Ø¨Ù„ Ù…Ù†Ø§ ÙˆØ§Ø¬Ø¹Ù„Ù‡ ÙÙŠ Ù…ÙŠØ²Ø§Ù† Ø­Ø³Ù†Ø§ØªÙ‡</div>
        <div class="visitor-counter" title="Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙˆØ§Ø± Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ">
            ğŸ‘¥ Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙˆØ§Ø±: <span id="visits">...</span>
        </div>
    </footer>
    <script>
        /* ===== Install Button ===== */
        let deferredPrompt;
        const installBtn = document.createElement('button');
        installBtn.innerHTML = 'ğŸ“² ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚';
        installBtn.style.cssText = 'position:fixed;bottom:20px;right:20px;background:var(--primary);color:white;border:none;padding:12px 20px;border-radius:30px;font-family:Tajawal;font-weight:bold;z-index:1000;box-shadow:0 4px 15px rgba(0,0,0,0.3);display:none;cursor:pointer;';
        installBtn.onclick = installPWA;
        document.body.appendChild(installBtn);

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installBtn.style.display = 'block';
        });

        function installPWA() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') installBtn.style.display = 'none';
                    deferredPrompt = null;
                });
            }
        }

        /* ===== DATA ===== */
        const TASBEEH_AZKAR = ["Ø³ÙØ¨Ù’Ø­ÙØ§Ù†Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù", "Ø§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù Ù„ÙÙ„ÙÙ‘Ù‡Ù", "Ù„ÙØ§ Ø¥ÙÙ„ÙÙ‡Ù Ø¥ÙÙ„ÙÙ‘Ø§ Ø§Ù„Ù„ÙÙ‘Ù‡Ù", "Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø£ÙÙƒÙ’Ø¨ÙØ±Ù", "Ù„ÙØ§ Ø­ÙÙˆÙ’Ù„Ù ÙˆÙÙ„ÙØ§ Ù‚ÙÙˆÙÙ‘Ø©Ù Ø¥ÙÙ„ÙÙ‘Ø§ Ø¨ÙØ§Ù„Ù„ÙÙ‘Ù‡Ù", "Ø£ÙØ³Ù’ØªÙØºÙ’ÙÙØ±Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„Ù’Ø¹ÙØ¸ÙÙŠÙ…Ù", "Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ ØµÙÙ„ÙÙ‘ Ø¹ÙÙ„ÙÙ‰ Ù†ÙØ¨ÙÙŠÙ‘ÙÙ†ÙØ§ Ù…ÙØ­ÙÙ…ÙÙ‘Ø¯Ù"];
        
        const DECEASED_DUAS = [
            "Ø§Ù„Ù„Ù‡Ù… Ø§ØºÙØ± Ù„Ù„Ù…Ø±Ø­ÙˆÙ… ØµØ¨Ø±ÙŠ ÙƒØ§Ù…Ù„ Ø³Ù„ÙŠÙ… ÙˆØ§Ø±Ø­Ù…Ù‡ØŒ ÙˆØ¹Ø§ÙÙ‡ ÙˆØ§Ø¹Ù Ø¹Ù†Ù‡ØŒ ÙˆØ£ÙƒØ±Ù… Ù†Ø²Ù„Ù‡ØŒ ÙˆÙˆØ³Ø¹ Ù…Ø¯Ø®Ù„Ù‡.",
            "Ø§Ù„Ù„Ù‡Ù… Ø£Ø¨Ø¯Ù„Ù‡ Ø¯Ø§Ø±Ø§Ù‹ Ø®ÙŠØ±Ø§Ù‹ Ù…Ù† Ø¯Ø§Ø±Ù‡ØŒ ÙˆØ£Ù‡Ù„Ø§Ù‹ Ø®ÙŠØ±Ø§Ù‹ Ù…Ù† Ø£Ù‡Ù„Ù‡ØŒ ÙˆØ£Ø¯Ø®Ù„Ù‡ Ø§Ù„Ø¬Ù†Ø©ØŒ ÙˆØ£Ø¹Ø°Ù‡ Ù…Ù† Ø¹Ø°Ø§Ø¨ Ø§Ù„Ù‚Ø¨Ø±.",
            "Ø§Ù„Ù„Ù‡Ù… Ø§Ø¬Ø¹Ù„ Ù‚Ø¨Ø±Ù‡ Ø±ÙˆØ¶Ø© Ù…Ù† Ø±ÙŠØ§Ø¶ Ø§Ù„Ø¬Ù†Ø©ØŒ ÙˆÙ„Ø§ ØªØ¬Ø¹Ù„Ù‡ Ø­ÙØ±Ø© Ù…Ù† Ø­ÙØ± Ø§Ù„Ù†Ø§Ø±.",
            "Ø§Ù„Ù„Ù‡Ù… Ø§ÙØ³Ø­ Ù„Ù‡ ÙÙŠ Ù‚Ø¨Ø±Ù‡ Ù…Ø¯ Ø¨ØµØ±Ù‡ØŒ ÙˆØ§ÙØ±Ø´ Ù‚Ø¨Ø±Ù‡ Ù…Ù† ÙØ±Ø§Ø´ Ø§Ù„Ø¬Ù†Ø©.",
            "Ø§Ù„Ù„Ù‡Ù… Ø¥Ù†Ù‡ ÙÙŠ Ø°Ù…ØªÙƒ ÙˆØ­Ø¨Ù„ Ø¬ÙˆØ§Ø±ÙƒØŒ ÙÙ‚Ù‡ ÙØªÙ†Ø© Ø§Ù„Ù‚Ø¨Ø± ÙˆØ¹Ø°Ø§Ø¨ Ø§Ù„Ù†Ø§Ø±.",
            "Ø§Ù„Ù„Ù‡Ù… Ø¥Ù† ÙƒØ§Ù† Ù…Ø­Ø³Ù†Ø§Ù‹ ÙØ²Ø¯ ÙÙŠ Ø­Ø³Ù†Ø§ØªÙ‡ØŒ ÙˆØ¥Ù† ÙƒØ§Ù† Ù…Ø³ÙŠØ¦Ø§Ù‹ ÙØªØ¬Ø§ÙˆØ² Ø¹Ù† Ø³ÙŠØ¦Ø§ØªÙ‡.",
            "Ø§Ù„Ù„Ù‡Ù… Ø£Ø¯Ø®Ù„Ù‡ Ø§Ù„Ø¬Ù†Ø© Ù…Ù† ØºÙŠØ± Ù…Ù†Ø§Ù‚Ø´Ø© Ø­Ø³Ø§Ø¨ ÙˆÙ„Ø§ Ø³Ø§Ø¨Ù‚Ø© Ø¹Ø°Ø§Ø¨.",
            "Ø§Ù„Ù„Ù‡Ù… Ø¢Ù†Ø³Ù‡ ÙÙŠ ÙˆØ­Ø¯ØªÙ‡ØŒ ÙˆÙÙŠ ÙˆØ­Ø´ØªÙ‡ØŒ ÙˆÙÙŠ ØºØ±Ø¨ØªÙ‡.",
            "Ø§Ù„Ù„Ù‡Ù… Ø§Ø¬Ø¹Ù„ Ø¹Ù† ÙŠÙ…ÙŠÙ†Ù‡ Ù†ÙˆØ±Ø§Ù‹ØŒ ÙˆØ¹Ù† Ø´Ù…Ø§Ù„Ù‡ Ù†ÙˆØ±Ø§Ù‹ØŒ ÙˆÙ…Ù† Ø£Ù…Ø§Ù…Ù‡ Ù†ÙˆØ±Ø§Ù‹.",
            "Ø§Ù„Ù„Ù‡Ù… ÙŠÙ…Ù† ÙƒØªØ§Ø¨Ø©ØŒ ÙˆÙŠØ³Ø± Ø­Ø³Ø§Ø¨Ù‡ØŒ ÙˆØ«Ù‚Ù„ Ø¨Ø§Ù„Ø­Ø³Ù†Ø§Øª Ù…ÙŠØ²Ø§Ù†Ù‡."
        ];

        const GENERAL_DUAS = [
            "Ø±ÙØ¨ÙÙ‘Ù†ÙØ§ Ø¢ØªÙÙ†ÙØ§ ÙÙÙŠ Ø§Ù„Ø¯ÙÙ‘Ù†Ù’ÙŠÙØ§ Ø­ÙØ³ÙÙ†ÙØ©Ù‹ ÙˆÙÙÙÙŠ Ø§Ù„Ø¢Ø®ÙØ±ÙØ©Ù Ø­ÙØ³ÙÙ†ÙØ©Ù‹ ÙˆÙÙ‚ÙÙ†ÙØ§ Ø¹ÙØ°ÙØ§Ø¨Ù Ø§Ù„Ù†ÙÙ‘Ø§Ø±Ù.",
            "Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø¥ÙÙ†ÙÙ‘ÙŠ Ø£ÙØ³Ù’Ø£ÙÙ„ÙÙƒÙ Ø§Ù„Ù’Ù‡ÙØ¯ÙÙ‰ ÙˆÙØ§Ù„ØªÙÙ‘Ù‚ÙÙ‰ ÙˆÙØ§Ù„Ù’Ø¹ÙÙÙØ§ÙÙ ÙˆÙØ§Ù„Ù’ØºÙÙ†ÙÙ‰.",
            "ÙŠÙØ§ Ù…ÙÙ‚ÙÙ„ÙÙ‘Ø¨Ù Ø§Ù„Ù’Ù‚ÙÙ„ÙÙˆØ¨Ù Ø«ÙØ¨ÙÙ‘ØªÙ’ Ù‚ÙÙ„Ù’Ø¨ÙÙŠ Ø¹ÙÙ„ÙÙ‰ Ø¯ÙÙŠÙ†ÙÙƒÙ.",
            "Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø¥ÙÙ†ÙÙ‘ÙŠ Ø£ÙØ¹ÙÙˆØ°Ù Ø¨ÙÙƒÙ Ù…ÙÙ†Ù’ Ø²ÙÙˆÙØ§Ù„Ù Ù†ÙØ¹Ù’Ù…ÙØªÙÙƒÙØŒ ÙˆÙØªÙØ­ÙÙˆÙÙ‘Ù„Ù Ø¹ÙØ§ÙÙÙŠÙØªÙÙƒÙØŒ ÙˆÙÙÙØ¬ÙØ§Ø¡ÙØ©Ù Ù†ÙÙ‚Ù’Ù…ÙØªÙÙƒÙØŒ ÙˆÙØ¬ÙÙ…ÙÙŠØ¹Ù Ø³ÙØ®ÙØ·ÙÙƒÙ.",
            "Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø§Ø´Ù’ÙÙ Ù…ÙØ±Ù’Ø¶ÙØ§Ù†ÙØ§ ÙˆÙÙ…ÙØ±Ù’Ø¶ÙÙ‰ Ø§Ù„Ù’Ù…ÙØ³Ù’Ù„ÙÙ…ÙÙŠÙ†ÙØŒ ÙˆÙØ§Ø±Ù’Ø­ÙÙ…Ù’ Ù…ÙÙˆÙ’ØªÙØ§Ù†ÙØ§ ÙˆÙÙ…ÙÙˆÙ’ØªÙÙ‰ Ø§Ù„Ù’Ù…ÙØ³Ù’Ù„ÙÙ…ÙÙŠÙ†Ù.",
            "Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø£ÙØµÙ’Ù„ÙØ­Ù’ Ù„ÙÙŠ Ø¯ÙÙŠÙ†ÙÙŠ Ø§Ù„ÙÙ‘Ø°ÙÙŠ Ù‡ÙÙˆÙ Ø¹ÙØµÙ’Ù…ÙØ©Ù Ø£ÙÙ…Ù’Ø±ÙÙŠØŒ ÙˆÙØ£ÙØµÙ’Ù„ÙØ­Ù’ Ù„ÙÙŠ Ø¯ÙÙ†Ù’ÙŠÙØ§ÙŠÙ Ø§Ù„ÙÙ‘ØªÙÙŠ ÙÙÙŠÙ‡ÙØ§ Ù…ÙØ¹ÙØ§Ø´ÙÙŠ.",
            "Ø±ÙØ¨ÙÙ‘ Ø§Ø¬Ù’Ø¹ÙÙ„Ù’Ù†ÙÙŠ Ù…ÙÙ‚ÙÙŠÙ…Ù Ø§Ù„ØµÙÙ‘Ù„ÙØ§Ø©Ù ÙˆÙÙ…ÙÙ†Ù’ Ø°ÙØ±ÙÙ‘ÙŠÙÙ‘ØªÙÙŠ Ûš Ø±ÙØ¨ÙÙ‘Ù†ÙØ§ ÙˆÙØªÙÙ‚ÙØ¨ÙÙ‘Ù„Ù’ Ø¯ÙØ¹ÙØ§Ø¡Ù.",
            "Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø¥ÙÙ†ÙÙ‘ÙƒÙ Ø¹ÙÙÙÙˆÙŒÙ‘ ØªÙØ­ÙØ¨ÙÙ‘ Ø§Ù„Ù’Ø¹ÙÙÙ’ÙˆÙ ÙÙØ§Ø¹Ù’ÙÙ Ø¹ÙÙ†ÙÙ‘ÙŠ.",
            "Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø¥ÙÙ†ÙÙ‘ÙŠ Ø£ÙØ¹ÙÙˆØ°Ù Ø¨ÙÙƒÙ Ù…ÙÙ†Ù’ Ø§Ù„Ù’Ù‡ÙÙ…ÙÙ‘ ÙˆÙØ§Ù„Ù’Ø­ÙØ²ÙÙ†ÙØŒ ÙˆÙØ£ÙØ¹ÙÙˆØ°Ù Ø¨ÙÙƒÙ Ù…ÙÙ†Ù’ Ø§Ù„Ù’Ø¹ÙØ¬Ù’Ø²Ù ÙˆÙØ§Ù„Ù’ÙƒÙØ³ÙÙ„Ù.",
            "Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø§Ø¬Ù’Ø¹ÙÙ„Ù’Ù†ÙÙŠ ÙÙÙŠ Ø¯ÙØ±Ù’Ø¹ÙÙƒÙ Ø§Ù„Ù’Ø­ÙØµÙÙŠÙ†ÙØ©Ù Ø§Ù„ÙÙ‘ØªÙÙŠ ØªÙØ¬ÙÙŠØ±Ù Ø¨ÙÙ‡ÙØ§ Ù…ÙÙ†Ù’ Ø³ÙØ®ÙØ·ÙÙƒÙ.",
            "Ø±ÙØ¨ÙÙ‘ Ø§ØºÙ’ÙÙØ±Ù’ Ù„ÙÙŠ ÙˆÙÙ„ÙÙˆÙØ§Ù„ÙØ¯ÙÙŠÙÙ‘ ÙˆÙÙ„ÙÙ„Ù’Ù…ÙØ¤Ù’Ù…ÙÙ†ÙÙŠÙ†Ù ÙŠÙÙˆÙ’Ù…Ù ÙŠÙÙ‚ÙÙˆÙ…Ù Ø§Ù„Ù’Ø­ÙØ³ÙØ§Ø¨Ù.",
            "Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø¥ÙÙ†ÙÙ‘ÙŠ Ø£ÙØ³Ù’Ø£ÙÙ„ÙÙƒÙ Ø¹ÙÙ„Ù’Ù…Ù‹Ø§ Ù†ÙØ§ÙÙØ¹Ù‹Ø§ØŒ ÙˆÙØ±ÙØ²Ù’Ù‚Ù‹Ø§ Ø·ÙÙŠÙÙ‘Ø¨Ù‹Ø§ØŒ ÙˆÙØ¹ÙÙ…ÙÙ„Ù‹Ø§ Ù…ÙØªÙÙ‚ÙØ¨ÙÙ‘Ù„Ù‹Ø§.",
            "Ø±ÙØ¨ÙÙ‘Ù†ÙØ§ Ù„ÙØ§ ØªÙØ¤ÙØ§Ø®ÙØ°Ù’Ù†ÙØ§ Ø¥ÙÙ†Ù’ Ù†ÙØ³ÙÙŠÙ†ÙØ§ Ø£ÙÙˆÙ’ Ø£ÙØ®Ù’Ø·ÙØ£Ù’Ù†ÙØ§."
        ];

        const AZKAR = {
            morning: [{t:"Ø£ÙØµÙ’Ù€Ø¨ÙØ­Ù’Ù†Ø§ ÙˆÙØ£ÙØµÙ’Ù€Ø¨ÙØ­Ù Ø§Ù„Ù…ÙÙ€Ù„Ù’ÙƒÙ Ù„Ù„Ù‡...",c:"1"}, {t:"Ø§Ù„Ù„Ù‘Ù‡ÙÙ€Ù…Ù‘Ù Ù…Ø§ Ø£ÙØµÙ’Ø¨ÙÙ€Ø­Ù Ø¨ÙŠ Ù…ÙÙ€Ù†Ù’ Ù†ÙØ¹Ù’Ù€Ù…ÙØ©Ù...",c:"1"}, {t:"Ø³ÙØ¨Ù’Ø­Ù€Ø§Ù†Ù Ø§Ù„Ù„Ù‡Ù ÙˆÙØ¨ÙØ­ÙÙ…Ù’Ù€Ø¯ÙÙ‡Ù...",c:"3"}],
            evening: [{t:"Ø£ÙÙ…Ù’Ø³ÙÙŠÙ’Ù€Ù†Ø§ ÙˆÙØ£ÙÙ…Ù’Ø³Ù€Ù‰ Ø§Ù„Ù…ÙÙ€Ù„Ù’ÙƒÙ Ù„Ù„Ù‡...",c:"1"}, {t:"Ø§Ù„Ù„Ù‘Ù‡ÙÙ€Ù…Ù‘Ù Ø¨ÙÙƒÙ Ø£ÙÙ…Ù’Ø³ÙÙ€ÙŠÙ†Ø§...",c:"1"}, {t:"Ø£ÙØ¹Ù€ÙˆØ°Ù Ø¨ÙÙƒÙÙ„ÙÙ…Ù€Ø§ØªÙ Ø§Ù„Ù„Ù‘Ù‡Ù Ø§Ù„ØªÙ‘Ù€Ø§Ù…Ù‘Ù€Ø§ØªÙ...",c:"3"}]
        };

        let state = { count: 0, deceasedIdx: 0, generalIdx: 0, currentZekrIdx: 0, batchCount: 1 };
        const STORAGE_KEY = 'sabry_v12_full';

        /* ===== AUDIO PLAYER ===== */
        let currentAudio = null;
        let currentButton = null;

        function playAudio(url, button) {
            // Stop current if playing
            if (currentAudio) {
                currentAudio.pause();
                currentAudio = null;
                if (currentButton) {
                    const indicator = currentButton.querySelector('.playing-indicator');
                    if(indicator) indicator.style.display = 'none';
                    currentButton.innerHTML = currentButton.innerHTML.replace('â¹ï¸', 'ğŸ§');
                }
            }
            // If clicking same button, just stop
            if (currentButton === button) {
                currentButton = null;
                return;
            }
            // Play new
            currentAudio = new Audio(url);
            currentAudio.play();
            currentButton = button;
            
            // UI updates
            const indicator = button.querySelector('.playing-indicator');
            if(indicator) indicator.style.display = 'inline-block';
            button.innerHTML = button.innerHTML.replace('ğŸ§', 'â¹ï¸');
            
            currentAudio.onended = function() {
                if(indicator) indicator.style.display = 'none';
                button.innerHTML = button.innerHTML.replace('â¹ï¸', 'ğŸ§');
                currentAudio = null;
                currentButton = null;
            };
            currentAudio.onerror = function() {
                alert('ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ø§ÙˆØ©');
                if(indicator) indicator.style.display = 'none';
                button.innerHTML = button.innerHTML.replace('â¹ï¸', 'ğŸ§');
            };
        }

        /* ===== INIT ===== */
        document.addEventListener('DOMContentLoaded', () => {
            initTheme();
            loadData();
            state.deceasedIdx = state.deceasedIdx || Math.floor(Math.random() * DECEASED_DUAS.length);
            state.generalIdx = state.generalIdx || Math.floor(Math.random() * GENERAL_DUAS.length);
            updateUI();
            updateVisitorCounter();
            renderAzkar('morning');
            
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js').then(reg => {
                    reg.addEventListener('updatefound', () => {
                        const newWorker = reg.installing;
                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                if(confirm('ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙŠØ¯ Ù…ØªØ§Ø­! Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¢Ù†ØŸ')) window.location.reload();
                            }
                        });
                    });
                });
            }
        });

        /* ===== LOGIC ===== */
        function incrementCounter() {
            state.count++;
            if (navigator.vibrate) navigator.vibrate(15);
            if (state.count % 33 === 0) {
                state.currentZekrIdx = (state.currentZekrIdx + 1) % TASBEEH_AZKAR.length;
                state.batchCount++;
                confetti({ particleCount: 50, spread: 60, origin: { y: 0.6 }, colors: ['#1E6F5C', '#E9C46A'] });
                if (navigator.vibrate) navigator.vibrate([50, 50]);
            }
            updateCounterUI();
            saveData();
        }

        function updateCounterUI() {
            document.getElementById('totalCounter').textContent = state.count;
            document.getElementById('dhikrText').textContent = TASBEEH_AZKAR[state.currentZekrIdx];
            let currentBatch = (state.count % 33);
            if (state.count > 0 && currentBatch === 0) currentBatch = 33;
            document.getElementById('batchCounter').textContent = `${currentBatch} / 33`;
        }

        function confirmReset() {
            if(confirm('ØªØµÙÙŠØ± Ø§Ù„Ø¹Ø¯Ø§Ø¯ØŸ')) {
                state.count = 0;
                state.currentZekrIdx = 0;
                state.batchCount = 1;
                updateCounterUI();
                saveData();
            }
        }

        function saveData() { localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }
        function loadData() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if(saved) { try { state = JSON.parse(saved); } catch(e) {} }
        }

        /* ===== UI ===== */
        function updateDuaText(type) {
            if (type === 'deceased') {
                document.getElementById('deceasedDuaText').textContent = DECEASED_DUAS[state.deceasedIdx];
                document.getElementById('deceasedCounter').textContent = state.deceasedIdx + 1;
                document.getElementById('deceasedTotal').textContent = DECEASED_DUAS.length;
            } else {
                document.getElementById('generalDuaText').textContent = GENERAL_DUAS[state.generalIdx];
                document.getElementById('generalCounter').textContent = state.generalIdx + 1;
                document.getElementById('generalTotal').textContent = GENERAL_DUAS.length;
            }
        }

        function changeDua(type, dir) {
            if (type === 'deceased') {
                state.deceasedIdx += dir;
                if (state.deceasedIdx >= DECEASED_DUAS.length) state.deceasedIdx = 0;
                if (state.deceasedIdx < 0) state.deceasedIdx = DECEASED_DUAS.length - 1;
            } else {
                state.generalIdx += dir;
                if (state.generalIdx >= GENERAL_DUAS.length) state.generalIdx = 0;
                if (state.generalIdx < 0) state.generalIdx = GENERAL_DUAS.length - 1;
            }
            updateDuaText(type);
        }

        function copyDua(type) {
            const text = type === 'deceased' ? DECEASED_DUAS[state.deceasedIdx] : GENERAL_DUAS[state.generalIdx];
            const footer = type === 'deceased' ? "\n\n(Ø¹Ù† Ø±ÙˆØ­ Ø§Ù„Ù…Ø±Ø­ÙˆÙ… ØµØ¨Ø±ÙŠ ÙƒØ§Ù…Ù„ Ø³Ù„ÙŠÙ…)" : "";
            navigator.clipboard.writeText(text + footer).then(() => alert('ØªÙ… Ø§Ù„Ù†Ø³Ø®'));
        }

        function toggleAzkar(type, btn) {
            document.querySelectorAll('.azkar-opt').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            renderAzkar(type);
        }
        function renderAzkar(type) {
            const list = document.getElementById('azkarList');
            list.innerHTML = AZKAR[type].map(z => `<div class="zekr-item"><div style="font-family:'Amiri';font-size:1.1rem;line-height:1.8;margin-bottom:5px;">${z.t}</div><div style="font-size:0.8rem;color:var(--accent);font-weight:bold;">${z.c} Ù…Ø±Ø§Øª</div></div>`).join('');
        }
        
        function updateUI() { 
            updateCounterUI(); 
            updateDuaText('deceased'); 
            updateDuaText('general');
        }
        
        /* ===== GLOBAL COUNTER ===== */
        function updateVisitorCounter() {
            fetch('https://api.countapi.xyz/hit/sabry-kamel-memorial-global-v10/visits')
                .then(res => res.json())
                .then(data => {
                    document.getElementById('visits').innerText = data.value;
                })
                .catch(err => {
                    console.log('Counter Error');
                    document.getElementById('visits').innerText = '...';
                });
        }

        function initTheme() { if (localStorage.getItem('theme') === 'dark') document.body.setAttribute('data-theme', 'dark'); }
        function toggleTheme() {
            const isDark = document.body.getAttribute('data-theme') === 'dark';
            document.body.setAttribute('data-theme', isDark ? '' : 'dark');
            localStorage.setItem('theme', isDark ? 'light' : 'dark');
        }
        function switchTab(id, btn) {
            // Stop audio if playing
            if (currentAudio) {
                currentAudio.pause();
                currentAudio = null;
                if(currentButton) currentButton.innerHTML = currentButton.innerHTML.replace('â¹ï¸', 'ğŸ§');
            }
            
            document.querySelectorAll('.tab-content').forEach(e => e.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(e => e.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            btn.classList.add('active');
        }
        function shareCurrentPage() {
            if (navigator.share) navigator.share({ title: 'Ø§Ù„Ù…Ø±Ø­ÙˆÙ… ØµØ¨Ø±ÙŠ ÙƒØ§Ù…Ù„ Ø³Ù„ÙŠÙ…', url: window.location.href });
            else window.open(`https://wa.me/?text=${encodeURIComponent(window.location.href)}`);
        }
    </script>
</body>
</html>
